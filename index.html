<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxis Algérie - Application de Gestion des Avis et Plaintes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
        }
        header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 15px 0;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo i {
            font-size: 24px;
        }
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
        }
        .nav-icons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .nav-icons i {
            font-size: 20px;
            cursor: pointer;
        }
        .language-selector {
            display: flex;
            gap: 5px;
            margin-right: 10px;
        }
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .lang-btn.active {
            background: rgba(255, 255, 255, 0.4);
        }
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        .auth-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .welcome-banner {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .welcome-banner h2 {
            margin-bottom: 10px;
            font-size: 22px;
        }
        .welcome-banner p {
            font-size: 16px;
            opacity: 0.9;
        }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .action-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }
        .action-card i {
            font-size: 28px;
            margin-bottom: 10px;
            color: #3498db;
        }
        .action-card.rating i {
            color: #f39c12;
        }
        .action-card.complaint i {
            color: #e74c3c;
        }
        .action-card.driver i {
            color: #2ecc71;
        }
        .action-card.history i {
            color: #9b59b6;
        }
        .action-card h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        .action-card p {
            font-size: 13px;
            color: #7f8c8d;
        }
        .section-title {
            font-size: 18px;
            margin: 25px 0 15px;
            padding-left: 10px;
            border-left: 4px solid #3498db;
            color: #2c3e50;
        }
        .recent-ratings {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .rating-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        .rating-item:last-child {
            border-bottom: none;
        }
        .rating-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .rating-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        .rating-details h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }
        .rating-details p {
            font-size: 14px;
            color: #7f8c8d;
        }
        .rating-stars {
            color: #f39c12;
            font-size: 16px;
        }
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .stat-card i {
            font-size: 28px;
            margin-bottom: 10px;
            color: #3498db;
        }
        .stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .stat-card p {
            font-size: 14px;
            color: #7f8c8d;
        }
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            margin-top: 30px;
        }
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        .footer-links a {
            color: #ecf0f1;
            text-decoration: none;
            font-size: 14px;
        }
        .copyright {
            font-size: 14px;
            opacity: 0.8;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 0;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            margin: auto;
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2c3e50;
            text-align: center;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn-secondary {
            background: #7f8c8d;
        }
        .btn-secondary:hover {
            background: #636e72;
        }
        .btn-success {
            background: #2ecc71;
        }
        .btn-success:hover {
            background: #27ae60;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .star-rating {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        .star-rating i {
            font-size: 32px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .star-rating i.active {
            color: #f39c12;
        }
        .form-toggle {
            text-align: center;
            margin-top: 20px;
        }
        .form-toggle a {
            color: #3498db;
            text-decoration: none;
            cursor: pointer;
        }
        .form-toggle a:hover {
            text-decoration: underline;
        }
        .admin-dashboard {
            display: none;
        }
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        .admin-stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .admin-stat-card i {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .admin-stat-card.complaints i {
            color: #e74c3c;
        }
        .admin-stat-card.ratings i {
            color: #f39c12;
        }
        .admin-stat-card.drivers i {
            color: #3498db;
        }
        .admin-stat-card.users i {
            color: #2ecc71;
        }
        .admin-stat-card h3 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .admin-stat-card p {
            font-size: 14px;
            color: #7f8c8d;
        }
        .admin-table {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }
        .admin-table h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-pending {
            background: #ffeaa7;
            color: #d35400;
        }
        .status-resolved {
            background: #d1f7c4;
            color: #27ae60;
        }
        .status-rejected {
            background: #ffcfcc;
            color: #c0392b;
        }
        .status-danger {
            background: #ff6b6b;
            color: #e74c3c;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .action-btn.view {
            background: #3498db;
            color: white;
        }
        .action-btn.resolve {
            background: #2ecc71;
            color: white;
        }
        .action-btn.reject {
            background: #e74c3c;
            color: white;
        }
        .action-btn.danger {
            background: #ff6b6b;
            color: white;
        }
        .action-btn.notify {
            background: #f39c12;
            color: white;
        }
        .user-type-selector {
            display: flex;
            margin-bottom: 20px;
            background: #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
        }
        .user-type {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .user-type.active {
            background: #3498db;
            color: white;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notification-container {
            position: relative;
        }
        .driver-notifications {
            display: none;
            position: absolute;
            right: 0;
            top: 35px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        .notification-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .notification-item.unread {
            background: #f8f9fa;
        }
        .complaint-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .complaint-details h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .complaint-details p {
            margin-bottom: 8px;
        }
        .complaint-status {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .status-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .message-form {
            margin-top: 20px;
        }
        .login-error {
            color: #e74c3c;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        @media (max-width: 768px) {
            .quick-actions,
            .stats-cards,
            .admin-stats {
                grid-template-columns: 1fr;
            }
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            .logo h1 {
                font-size: 18px;
            }
            .auth-buttons {
                width: 100%;
                justify-content: center;
            }
            .complaint-status {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-taxi"></i>
                    <h1 id="header-title">Taxis Algérie</h1>
                </div>
                <div class="nav-icons">
                    <div class="language-selector">
                        <button class="lang-btn active" data-lang="fr">FR</button>
                        <button class="lang-btn" data-lang="ar">AR</button>
                        <button class="lang-btn" data-lang="en">EN</button>
                    </div>
                    <div class="notification-container" id="notification-container" style="display: none;">
                        <i class="fas fa-bell" onclick="toggleNotifications()"></i>
                        <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                        <div class="driver-notifications" id="driver-notifications">
                            <h4 id="notifications-title">Notifications</h4>
                            <div id="notifications-list"></div>
                        </div>
                    </div>
                    <i class="fas fa-user" onclick="toggleUserMenu()"></i>
                    <i class="fas fa-cog" onclick="showSettings()"></i>
                </div>
                <div class="auth-buttons">
                    <button class="auth-btn" onclick="openLoginModal()" id="login-btn">Connexion</button>
                    <button class="auth-btn" onclick="openRegisterModal()" id="register-btn">Inscription</button>
                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <!-- Interface principale -->
        <div id="main-interface">
            <div class="welcome-banner">
                <h2 id="welcome-title">Bienvenue dans l'application Taxis Algérie</h2>
                <p id="welcome-text">Noter votre chauffeur, déposez une plainte ou consultez l'historique de vos courses</p>
            </div>
            <div class="quick-actions">
                <div class="action-card rating" onclick="openRatingModal()" id="rating-card">
                    <i class="fas fa-star"></i>
                    <h3 id="rating-title">Noter un chauffeur</h3>
                    <p id="rating-text">Évaluez votre expérience</p>
                </div>
                <div class="action-card complaint" onclick="openComplaintModal()" id="complaint-card">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3 id="complaint-title">Déposer une plainte</h3>
                    <p id="complaint-text">Signaler un problème</p>
                </div>
                <div class="action-card driver" onclick="openDriverRegisterModal()" id="driver-card">
                    <i class="fas fa-id-card"></i>
                    <h3 id="driver-title">Enregistrer taxi</h3>
                    <p id="driver-text">Inscrivez votre véhicule</p>
                </div>
                <div class="action-card history" onclick="openHistoryModal()" id="history-card">
                    <i class="fas fa-history"></i>
                    <h3 id="history-title">Historique</h3>
                    <p id="history-text">Vos courses précédentes</p>
                </div>
            </div>
            <h2 class="section-title" id="recent-ratings-title">Vos notations récentes</h2>
            <div class="recent-ratings" id="recent-ratings-container">
                <!-- Les notes seront chargées dynamiquement -->
            </div>
            <h2 class="section-title" id="stats-title">Statistiques</h2>
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-star-half-alt"></i>
                    <h3 id="average-rating-value">4.2</h3>
                    <p id="average-rating-text">Note moyenne</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-taxi"></i>
                    <h3 id="rated-rides-value">24</h3>
                    <p id="rated-rides-text">Courses notées</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-thumbs-up"></i>
                    <h3 id="satisfaction-value">92%</h3>
                    <p id="satisfaction-text">Satisfaction</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-flag"></i>
                    <h3 id="complaints-filed-value">3</h3>
                    <p id="complaints-filed-text">Plaintes déposées</p>
                </div>
            </div>
        </div>
        <!-- Tableau de bord administrateur -->
        <div id="admin-dashboard" class="admin-dashboard">
            <h2 class="section-title" id="admin-dashboard-title">Tableau de bord administrateur</h2>
            <div class="admin-stats">
                <div class="admin-stat-card complaints">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3 id="pending-complaints-value">47</h3>
                    <p id="pending-complaints-text">Plaintes en attente</p>
                </div>
                <div class="admin-stat-card ratings">
                    <i class="fas fa-star"></i>
                    <h3 id="reviews-this-month-value">156</h3>
                    <p id="reviews-this-month-text">Avis ce mois-ci</p>
                </div>
                <div class="admin-stat-card drivers">
                    <i class="fas fa-taxi"></i>
                    <h3 id="registered-drivers-value">324</h3>
                    <p id="registered-drivers-text">Chauffeurs enregistrés</p>
                </div>
                <div class="admin-stat-card users">
                    <i class="fas fa-users"></i>
                    <h3 id="active-users-value">1,248</h3>
                    <p id="active-users-text">Utilisateurs actifs</p>
                </div>
            </div>
            <div class="admin-table">
                <h3 id="recent-complaints-text">Plaintes récentes</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th id="date-text">Date</th>
                            <th id="taxi-text">Taxi</th>
                            <th id="type-text">Type</th>
                            <th id="status-text">Statut</th>
                            <th id="actions-text">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recent-complaints-list">
                        <!-- Les plaintes seront chargées dynamiquement -->
                    </tbody>
                </table>
            </div>
            <div class="admin-table">
                <h3 id="recent-reviews-text">Avis récents</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th id="date-text2">Date</th>
                            <th id="driver-text">Chauffeur</th>
                            <th id="rating-text2">Note</th>
                            <th id="actions-text2">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recent-reviews-list">
                        <!-- Les avis seront chargés dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <footer>
        <div class="container">
            <div class="footer-links">
                <a href="#" id="about-link">À propos</a>
                <a href="#" id="privacy-link">Confidentialité</a>
                <a href="#" id="terms-link">Conditions</a>
                <a href="#" id="help-link">Aide</a>
            </div>
            <p class="copyright" id="copyright-text">© 2023 Taxis Algérie. Tous droits réservés.</p>
        </div>
    </footer>
    <!-- Modals -->
    <!-- Modal de connexion -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('loginModal')">&times;</span>
            <h2 class="modal-title" id="login-title">Connexion</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail" id="login-email-label">Email ou téléphone</label>
                    <input type="text" id="loginEmail" placeholder="Votre email ou numéro de téléphone" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword" id="login-password-label">Mot de passe</label>
                    <input type="password" id="loginPassword" placeholder="Votre mot de passe" required>
                </div>
                <div class="login-error" id="login-error">Email ou mot de passe incorrect</div>
                <button type="button" class="btn" onclick="login()" id="login-button">Se connecter</button>
                <div class="form-toggle">
                    <p id="no-account-text">Pas encore inscrit? <a onclick="switchToRegister()" id="create-account-link">Créer un compte</a></p>
                </div>
                <div class="form-toggle">
                    <p><a onclick="switchToAdminLogin()" id="admin-access-link">Accès administrateur</a></p>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal de connexion administrateur -->
    <div class="modal" id="adminLoginModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('adminLoginModal')">&times;</span>
            <h2 class="modal-title" id="admin-login-title">Connexion Administrateur</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="adminEmail" id="admin-email-label">Email administrateur</label>
                    <input type="email" id="adminEmail" placeholder="Email administrateur" required>
                </div>
                <div class="form-group">
                    <label for="adminPassword" id="admin-password-label">Mot de passe administrateur</label>
                    <input type="password" id="adminPassword" placeholder="Mot de passe administrateur" required>
                </div>
                <div class="login-error" id="admin-login-error">Identifiants administrateur incorrects</div>
                <button type="button" class="btn btn-danger" onclick="adminLogin()" id="admin-login-button">Connexion Admin</button>
                <div class="form-toggle">
                    <p><a onclick="switchToUserLogin()" id="standard-user-link">Connexion utilisateur standard</a></p>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal d'inscription -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('registerModal')">&times;</span>
            <h2 class="modal-title" id="create-account-title">Créer un compte</h2>
            <div class="user-type-selector">
                <div class="user-type active" id="client-type" onclick="selectUserType('client')" data-i18n="client-text">Client</div>
                <div class="user-type" id="driver-type" onclick="selectUserType('driver')" data-i18n="driver-text">Chauffeur</div>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName" id="fullname-label">Nom complet</label>
                    <input type="text" id="registerName" placeholder="Votre nom complet" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail" id="email-label">Email</label>
                    <input type="email" id="registerEmail" placeholder="Votre adresse email" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone" id="phone-label">Téléphone</label>
                    <input type="tel" id="registerPhone" placeholder="Votre numéro de téléphone" required>
                </div>
                <div id="driver-fields" style="display: none;">
                    <div class="form-group">
                        <label for="registerLicense" id="license-label">Numéro de permis</label>
                        <input type="text" id="registerLicense" placeholder="Votre numéro de permis">
                    </div>
                    <div class="form-group">
                        <label for="registerTaxiNumber" id="taxi-number-label">Numéro de taxi</label>
                        <input type="text" id="registerTaxiNumber" placeholder="Numéro d'identification du taxi">
                    </div>
                    <div class="form-group">
                        <label for="registerMatricule" id="matricule-label">Immatriculation</label>
                        <input type="text" id="registerMatricule" placeholder="Immatriculation du véhicule">
                    </div>
                </div>
                <div class="form-group">
                    <label for="registerPassword" id="password-label">Mot de passe</label>
                    <input type="password" id="registerPassword" placeholder="Créez un mot de passe" required>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword" id="confirm-password-label">Confirmer le mot de passe</label>
                    <input type="password" id="registerConfirmPassword" placeholder="Confirmez votre mot de passe" required>
                </div>
                <button type="button" class="btn btn-success" onclick="register()" id="create-account-button">Créer le compte</button>
                <div class="form-toggle">
                    <p id="already-registered-text">Déjà inscrit? <a onclick="switchToLogin()" id="login-link">Se connecter</a></p>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal d'enregistrement de taxi -->
    <div class="modal" id="driverRegisterModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('driverRegisterModal')">&times;</span>
            <h2 class="modal-title" id="taxi-registration-title">Enregistrement de taxi</h2>
            <form id="driverRegisterForm">
                <div class="form-group">
                    <label for="driverName" id="driver-name-label">Nom complet</label>
                    <input type="text" id="driverName" placeholder="Votre nom complet" required>
                </div>
                <div class="form-group">
                    <label for="driverLicense" id="driver-license-label">Numéro de permis</label>
                    <input type="text" id="driverLicense" placeholder="Votre numéro de permis" required>
                </div>
                <div class="form-group">
                    <label for="driverTaxiNumber" id="driver-taxi-number-label">Numéro de taxi</label>
                    <input type="text" id="driverTaxiNumber" placeholder="Numéro d'identification du taxi" required>
                </div>
                <div class="form-group">
                    <label for="driverMatricule" id="driver-matricule-label">Immatriculation</label>
                    <input type="text" id="driverMatricule" placeholder="Immatriculation du véhicule" required>
                </div>
                <div class="form-group">
                    <label for="driverPhone" id="driver-phone-label">Téléphone</label>
                    <input type="tel" id="driverPhone" placeholder="Votre numéro de téléphone" required>
                </div>
                <div class="form-group">
                    <label for="driverEmail" id="driver-email-label">Email</label>
                    <input type="email" id="driverEmail" placeholder="Votre adresse email" required>
                </div>
                <button type="button" class="btn btn-success" onclick="registerDriver()" id="register-taxi-button">Enregistrer le taxi</button>
            </form>
        </div>
    </div>
    <!-- Modal de notation -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('ratingModal')">&times;</span>
            <h2 class="modal-title" id="rate-driver-title">Noter votre chauffeur</h2>
            <form id="ratingForm">
                <div class="form-group">
                    <label for="taxiNumber" id="taxi-number-label2">Numéro de taxi ou immatriculation</label>
                    <input type="text" id="taxiNumber" placeholder="Ex: 123456 ou 123T1234" required>
                </div>
                <div class="form-group">
                    <label id="rating-label">Note</label>
                    <div class="star-rating">
                        <i class="far fa-star" data-rating="1"></i>
                        <i class="far fa-star" data-rating="2"></i>
                        <i class="far fa-star" data-rating="3"></i>
                        <i class="far fa-star" data-rating="4"></i>
                        <i class="far fa-star" data-rating="5"></i>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ratingComment" id="comment-label">Commentaire (optionnel)</label>
                    <textarea id="ratingComment" placeholder="Décrivez votre expérience..."></textarea>
                </div>
                <button type="button" class="btn" onclick="submitRating()" id="submit-rating-button">Soumettre l'avis</button>
            </form>
        </div>
    </div>
    <!-- Modal de plainte -->
    <div class="modal" id="complaintModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('complaintModal')">&times;</span>
            <h2 class="modal-title" id="file-complaint-title">Déposer une plainte</h2>
            <form id="complaintForm">
                <div class="form-group">
                    <label for="complaintTaxiNumber" id="complaint-taxi-number-label">Numéro de taxi ou immatriculation *</label>
                    <input type="text" id="complaintTaxiNumber" placeholder="Ex: 123456 ou 123T1234" required>
                </div>
                <div class="form-group">
                    <label for="complaintType" id="complaint-type-label">Type de plainte *</label>
                    <select id="complaintType" required>
                        <option value="">Sélectionnez un type</option>
                        <option value="behavior" id="behavior-option">Comportement du chauffeur</option>
                        <option value="price" id="price-option">Problème de prix</option>
                        <option value="vehicle" id="vehicle-option">État du véhicule</option>
                        <option value="route" id="route-option">Itinéraire inapproprié</option>
                        <option value="other" id="other-option">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="complaintDetails" id="complaint-details-label">Détails de la plainte *</label>
                    <textarea id="complaintDetails" placeholder="Décrivez le problème en détail..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="complaintDate" id="complaint-date-label">Date et heure *</label>
                    <input type="datetime-local" id="complaintDate" required>
                </div>
                <div class="form-group">
                    <label for="complaintLocation" id="complaint-location-label">Lieu (optionnel)</label>
                    <input type="text" id="complaintLocation" placeholder="Lieu où s'est produit l'incident">
                </div>
                <button type="button" class="btn" onclick="submitComplaint()" id="submit-complaint-button">Soumettre la plainte</button>
            </form>
        </div>
    </div>
    <!-- Modal de détail de plainte -->
    <div class="modal" id="complaintDetailModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('complaintDetailModal')">&times;</span>
            <h2 class="modal-title" id="complaint-detail-title">Détail de la plainte #<span id="complaint-id"></span></h2>
            <div class="complaint-details">
                <h4 id="complaint-info-title">Informations sur la plainte</h4>
                <p><strong id="complaint-date-label2">Date:</strong> <span id="complaint-date-value"></span></p>
                <p><strong id="complaint-taxi-label">Taxi:</strong> <span id="complaint-taxi-value"></span></p>
                <p><strong id="complaint-type-label2">Type:</strong> <span id="complaint-type-value"></span></p>
                <p><strong id="complaint-status-label">Statut:</strong> <span id="complaint-status-value"></span></p>
                <p><strong id="complaint-details-label2">Détails:</strong></p>
                <p id="complaint-details-value"></p>
            </div>
            <div class="complaint-status">
                <h4 id="update-status-title">Mettre à jour le statut</h4>
                <div class="status-option">
                    <input type="radio" id="status-pending" name="complaintStatus" value="pending">
                    <label for="status-pending" id="status-pending-label">En attente</label>
                </div>
                <div class="status-option">
                    <input type="radio" id="status-resolved" name="complaintStatus" value="resolved">
                    <label for="status-resolved" id="status-resolved-label">Résolue</label>
                </div>
                <div class="status-option">
                    <input type="radio" id="status-rejected" name="complaintStatus" value="rejected">
                    <label for="status-rejected" id="status-rejected-label">Rejetée</label>
                </div>
                <div class="status-option">
                    <input type="radio" id="status-danger" name="complaintStatus" value="danger">
                    <label for="status-danger" id="status-danger-label">Danger</label>
                </div>
            </div>
            <div class="message-form">
                <div class="form-group">
                    <label for="driverMessage" id="message-driver-label">Message au chauffeur</label>
                    <textarea id="driverMessage" placeholder="Message à envoyer au chauffeur..."></textarea>
                </div>
                <button type="button" class="btn btn-success" onclick="updateComplaintStatus()" id="update-status-button">Mettre à jour le statut</button>
                <button type="button" class="btn notify" onclick="sendMessageToDriver()" id="send-message-button">Envoyer message</button>
            </div>
        </div>
    </div>
    <!-- Modal d'historique -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('historyModal')">&times;</span>
            <h2 class="modal-title" id="history-modal-title">Historique des courses</h2>
            <div class="admin-table">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Chauffeur</th>
                            <th>Note</th>
                            <th>Commentaire</th>
                        </tr>
                    </thead>
                    <tbody id="history-list">
                        <!-- Les données seront chargées dynamiquement -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        // Variables globales
        let currentRating = 0;
        let currentUser = null;
        let userType = 'client';
        let currentLanguage = 'fr';
        let notificationsVisible = false;
        let currentComplaintId = null;

        // Données factices
        const mockUsers = [
            { id: 1, email: 'admin@taxis-algerie.dz', password: 'admin123', name: 'Administrateur', type: 'admin' },
            { id: 2, email: 'client@example.com', password: 'client123', name: 'Ahmed Mohamed', type: 'client' },
            { id: 3, email: 'chauffeur@example.com', password: 'chauffeur123', name: 'Karim Driver', type: 'driver', license: 'LIC12345', taxiNumber: 'TXI67890', matricule: '123T4567', phone: '0555123456' }
        ];

        // Notifications pour les chauffeurs
        let driverNotifications = [];

        // Textes multilingues
        const translations = {
            fr: {
                "header-title": "Taxis Algérie",
                "login-btn": "Connexion",
                "register-btn": "Inscription",
                "welcome-title": "Bienvenue dans l'application Taxis Algérie",
                "welcome-text": "Noter votre chauffeur, déposez une plainte ou consultez l'historique de vos courses",
                "rating-title": "Noter un chauffeur",
                "rating-text": "Évaluez votre expérience",
                "complaint-title": "Déposer une plainte",
                "complaint-text": "Signaler un problème",
                "driver-title": "Enregistrer taxi",
                "driver-text": "Inscrivez votre véhicule",
                "history-title": "Historique",
                "history-text": "Vos courses précédentes",
                "recent-ratings-title": "Vos notations récentes",
                "stats-title": "Statistiques",
                "average-rating-text": "Note moyenne",
                "rated-rides-text": "Courses notées",
                "satisfaction-text": "Satisfaction",
                "complaints-filed-text": "Plaintes déposées",
                "admin-dashboard-title": "Tableau de bord administrateur",
                "pending-complaints-text": "Plaintes en attente",
                "reviews-this-month-text": "Avis ce mois-ci",
                "registered-drivers-text": "Chauffeurs enregistrés",
                "active-users-text": "Utilisateurs actifs",
                "recent-complaints-text": "Plaintes récentes",
                "date-text": "Date",
                "taxi-text": "Taxi",
                "type-text": "Type",
                "status-text": "Statut",
                "actions-text": "Actions",
                "pending-text": "En attente",
                "view-text": "Voir",
                "resolve-text": "Résoudre",
                "reject-text": "Rejeter",
                "danger-text": "Danger",
                "resolved-text": "Résolu",
                "rejected-text": "Rejeté",
                "recent-reviews-text": "Avis récents",
                "date-text2": "Date",
                "driver-text": "Chauffeur",
                "rating-text2": "Note",
                "actions-text2": "Actions",
                "about-link": "À propos",
                "privacy-link": "Confidentialité",
                "terms-link": "Conditions",
                "help-link": "Aide",
                "copyright-text": "© 2023 Taxis Algérie. Tous droits réservés.",
                "login-title": "Connexion",
                "login-email-label": "Email ou téléphone",
                "login-password-label": "Mot de passe",
                "login-button": "Se connecter",
                "no-account-text": "Pas encore inscrit?",
                "create-account-link": "Créer un compte",
                "admin-access-link": "Accès administrateur",
                "admin-login-title": "Connexion Administrateur",
                "admin-email-label": "Email administrateur",
                "admin-password-label": "Mot de passe administrateur",
                "admin-login-button": "Connexion Admin",
                "standard-user-link": "Connexion utilisateur standard",
                "create-account-title": "Créer un compte",
                "client-text": "Client",
                "driver-text": "Chauffeur",
                "fullname-label": "Nom complet",
                "email-label": "Email",
                "phone-label": "Téléphone",
                "license-label": "Numéro de permis",
                "taxi-number-label": "Numéro de taxi",
                "matricule-label": "Immatriculation",
                "password-label": "Mot de passe",
                "confirm-password-label": "Confirmer le mot de passe",
                "create-account-button": "Créer le compte",
                "already-registered-text": "Déjà inscrit?",
                "login-link": "Se connecter",
                "taxi-registration-title": "Enregistrement de taxi",
                "driver-name-label": "Nom complet",
                "driver-license-label": "Numéro de permis",
                "driver-taxi-number-label": "Numéro de taxi",
                "driver-matricule-label": "Immatriculation",
                "driver-phone-label": "Téléphone",
                "driver-email-label": "Email",
                "register-taxi-button": "Enregistrer le taxi",
                "rate-driver-title": "Noter votre chauffeur",
                "taxi-number-label2": "Numéro de taxi ou immatriculation",
                "rating-label": "Note",
                "comment-label": "Commentaire (optionnel)",
                "submit-rating-button": "Soumettre l'avis",
                "file-complaint-title": "Déposer une plainte",
                "complaint-taxi-number-label": "Numéro de taxi ou immatriculation *",
                "complaint-type-label": "Type de plainte *",
                "behavior-option": "Comportement du chauffeur",
                "price-option": "Problème de prix",
                "vehicle-option": "État du véhicule",
                "route-option": "Itinéraire inapproprié",
                "other-option": "Autre",
                "complaint-details-label": "Détails de la plainte *",
                "complaint-date-label": "Date et heure *",
                "complaint-location-label": "Lieu (optionnel)",
                "submit-complaint-button": "Soumettre la plainte",
                "complaint-detail-title": "Détail de la plainte #",
                "complaint-info-title": "Informations sur la plainte",
                "complaint-date-label2": "Date:",
                "complaint-taxi-label": "Taxi:",
                "complaint-type-label2": "Type:",
                "complaint-status-label": "Statut:",
                "complaint-details-label2": "Détails:",
                "update-status-title": "Mettre à jour le statut",
                "status-pending-label": "En attente",
                "status-resolved-label": "Résolue",
                "status-rejected-label": "Rejetée",
                "status-danger-label": "Danger",
                "message-driver-label": "Message au chauffeur",
                "update-status-button": "Mettre à jour le statut",
                "send-message-button": "Envoyer message",
                "notifications-title": "Notifications",
                "notification-from": "De",
                "mark-read": "Marquer comme lu",
                "mark-unread": "Marquer comme non lu",
                "no-notifications": "Aucune notification",
                "login-error": "Email ou mot de passe incorrect",
                "admin-login-error": "Identifiants administrateur incorrects",
                "history-modal-title": "Historique des courses"
            },
            ar: {
                "header-title": "تاكسي الجزائر",
                "login-btn": "تسجيل الدخول",
                "register-btn": "تسجيل",
                "welcome-title": "مرحبًا بك في تطبيق تاكسي الجزائر",
                "welcome-text": "قيم سائقك، قدم شكوى أو استعرض تاريخ رحلاتك",
                "rating-title": "تقييم السائق",
                "rating-text": "قيم تجربتك",
                "complaint-title": "تقديم شكوى",
                "complaint-text": "الإبلاغ عن مشكلة",
                "driver-title": "تسجيل تاكسي",
                "driver-text": "سجل مركبتك",
                "history-title": "السجل",
                "history-text": "رحلاتك السابقة",
                "recent-ratings-title": "تقييماتك الأخيرة",
                "stats-title": "الإحصائيات",
                "average-rating-text": "متوسط التقييم",
                "rated-rides-text": "الرحلات المقيمة",
                "satisfaction-text": "الرضا",
                "complaints-filed-text": "الشكاوى المقدمة",
                "admin-dashboard-title": "لوحة تحكم المشرف",
                "pending-complaints-text": "شكاوى قيد الانتظار",
                "reviews-this-month-text": "التقييمات هذا الشهر",
                "registered-drivers-text": "السائقين المسجلين",
                "active-users-text": "المستخدمين النشطين",
                "recent-complaints-text": "الشكاوى الأخيرة",
                "date-text": "التاريخ",
                "taxi-text": "التاكسي",
                "type-text": "النوع",
                "status-text": "الحالة",
                "actions-text": "الإجراءات",
                "pending-text": "قيد الانتظار",
                "view-text": "عرض",
                "resolve-text": "حل",
                "reject-text": "رفض",
                "danger-text": "خطر",
                "resolved-text": "تم الحل",
                "rejected-text": "مرفوض",
                "recent-reviews-text": "التقييمات الأخيرة",
                "date-text2": "التاريخ",
                "driver-text": "السائق",
                "rating-text2": "التقييم",
                "actions-text2": "الإجراءات",
                "about-link": "عن التطبيق",
                "privacy-link": "الخصوصية",
                "terms-link": "الشروط",
                "help-link": "مساعدة",
                "copyright-text": "© 2023 تاكسي الجزائر. جميع الحقوق محفوظة.",
                "login-title": "تسجيل الدخول",
                "login-email-label": "البريد الإلكتروني أو الهاتف",
                "login-password-label": "كلمة المرور",
                "login-button": "تسجيل الدخول",
                "no-account-text": "ليس لديك حساب؟",
                "create-account-link": "إنشاء حساب",
                "admin-access-link": "وصول المشرف",
                "admin-login-title": "تسجيل دخول المشرف",
                "admin-email-label": "البريد الإلكتروني للمشرف",
                "admin-password-label": "كلمة مرور المشرف",
                "admin-login-button": "تسجيل دخول المشرف",
                "standard-user-link": "تسجيل دخول المستخدم العادي",
                "create-account-title": "إنشاء حساب",
                "client-text": "عميل",
                "driver-text": "سائق",
                "fullname-label": "الاسم الكامل",
                "email-label": "البريد الإلكتروني",
                "phone-label": "الهاتف",
                "license-label": "رقم الرخصة",
                "taxi-number-label": "رقم التاكسي",
                "matricule-label": "رقم التسجيل",
                "password-label": "كلمة المرور",
                "confirm-password-label": "تأكيد كلمة المرور",
                "create-account-button": "إنشاء الحساب",
                "already-registered-text": "لديك حساب بالفعل؟",
                "login-link": "تسجيل الدخول",
                "taxi-registration-title": "تسجيل التاكسي",
                "driver-name-label": "الاسم الكامل",
                "driver-license-label": "رقم الرخصة",
                "driver-taxi-number-label": "رقم التاكسي",
                "driver-matricule-label": "رقم التسجيل",
                "driver-phone-label": "الهاتف",
                "driver-email-label": "البريد الإلكتروني",
                "register-taxi-button": "تسجيل التاكسي",
                "rate-driver-title": "قيم سائقك",
                "taxi-number-label2": "رقم التاكسي أو رقم التسجيل",
                "rating-label": "التقييم",
                "comment-label": "تعليق (اختياري)",
                "submit-rating-button": "إرسال التقييم",
                "file-complaint-title": "تقديم شكوى",
                "complaint-taxi-number-label": "رقم التاكسي أو رقم التسجيل *",
                "complaint-type-label": "نوع الشكوى *",
                "behavior-option": "سلوك السائق",
                "price-option": "مشكلة السعر",
                "vehicle-option": "حالة المركبة",
                "route-option": "مسار غير مناسب",
                "other-option": "أخرى",
                "complaint-details-label": "تفاصيل الشكوى *",
                "complaint-date-label": "التاريخ والوقت *",
                "complaint-location-label": "المكان (اختياري)",
                "submit-complaint-button": "إرسال الشكوى",
                "complaint-detail-title": "تفاصيل الشكوى #",
                "complaint-info-title": "معلومات عن الشكوى",
                "complaint-date-label2": "التاريخ:",
                "complaint-taxi-label": "التاكسي:",
                "complaint-type-label2": "النوع:",
                "complaint-status-label": "الحالة:",
                "complaint-details-label2": "التفاصيل:",
                "update-status-title": "تحديث الحالة",
                "status-pending-label": "قيد الانتظار",
                "status-resolved-label": "تم الحل",
                "status-rejected-label": "مرفوض",
                "status-danger-label": "خطر",
                "message-driver-label": "رسالة إلى السائق",
                "update-status-button": "تحديث الحالة",
                "send-message-button": "إرسال رسالة",
                "notifications-title": "الإشعارات",
                "notification-from": "من",
                "mark-read": "وضع علامة مقروء",
                "mark-unread": "وضع علامة غير مقروء",
                "no-notifications": "لا توجد إشعارات",
                "login-error": "البريد الإلكتروني أو كلمة المرور غير صحيحة",
                "admin-login-error": "بيانات اعتماد المشرف غير صحيحة",
                "history-modal-title": "سجل الرحلات"
            },
            en: {
                "header-title": "Taxis Algeria",
                "login-btn": "Login",
                "register-btn": "Register",
                "welcome-title": "Welcome to Taxis Algeria App",
                "welcome-text": "Rate your driver, file a complaint or check your ride history",
                "rating-title": "Rate a driver",
                "rating-text": "Evaluate your experience",
                "complaint-title": "File a complaint",
                "complaint-text": "Report a problem",
                "driver-title": "Register taxi",
                "driver-text": "Register your vehicle",
                "history-title": "History",
                "history-text": "Your previous rides",
                "recent-ratings-title": "Your recent ratings",
                "stats-title": "Statistics",
                "average-rating-text": "Average rating",
                "rated-rides-text": "Rated rides",
                "satisfaction-text": "Satisfaction",
                "complaints-filed-text": "Complaints filed",
                "admin-dashboard-title": "Admin Dashboard",
                "pending-complaints-text": "Pending complaints",
                "reviews-this-month-text": "Reviews this month",
                "registered-drivers-text": "Registered drivers",
                "active-users-text": "Active users",
                "recent-complaints-text": "Recent complaints",
                "date-text": "Date",
                "taxi-text": "Taxi",
                "type-text": "Type",
                "status-text": "Status",
                "actions-text": "Actions",
                "pending-text": "Pending",
                "view-text": "View",
                "resolve-text": "Resolve",
                "reject-text": "Reject",
                "danger-text": "Danger",
                "resolved-text": "Resolved",
                "rejected-text": "Rejected",
                "recent-reviews-text": "Recent reviews",
                "date-text2": "Date",
                "driver-text": "Driver",
                "rating-text2": "Rating",
                "actions-text2": "Actions",
                "about-link": "About",
                "privacy-link": "Privacy",
                "terms-link": "Terms",
                "help-link": "Help",
                "copyright-text": "© 2023 Taxis Algeria. All rights reserved.",
                "login-title": "Login",
                "login-email-label": "Email or phone",
                "login-password-label": "Password",
                "login-button": "Login",
                "no-account-text": "Not registered yet?",
                "create-account-link": "Create an account",
                "admin-access-link": "Admin access",
                "admin-login-title": "Admin Login",
                "admin-email-label": "Admin email",
                "admin-password-label": "Admin password",
                "admin-login-button": "Admin Login",
                "standard-user-link": "Standard user login",
                "create-account-title": "Create Account",
                "client-text": "Client",
                "driver-text": "Driver",
                "fullname-label": "Full name",
                "email-label": "Email",
                "phone-label": "Phone",
                "license-label": "License number",
                "taxi-number-label": "Taxi number",
                "matricule-label": "Registration number",
                "password-label": "Password",
                "confirm-password-label": "Confirm password",
                "create-account-button": "Create account",
                "already-registered-text": "Already registered?",
                "login-link": "Login",
                "taxi-registration-title": "Taxi Registration",
                "driver-name-label": "Full name",
                "driver-license-label": "License number",
                "driver-taxi-number-label": "Taxi number",
                "driver-matricule-label": "Registration number",
                "driver-phone-label": "Phone",
                "driver-email-label": "Email",
                "register-taxi-button": "Register taxi",
                "rate-driver-title": "Rate your driver",
                "taxi-number-label2": "Taxi number or registration",
                "rating-label": "Rating",
                "comment-label": "Comment (optional)",
                "submit-rating-button": "Submit rating",
                "file-complaint-title": "File a complaint",
                "complaint-taxi-number-label": "Taxi number or registration *",
                "complaint-type-label": "Complaint type *",
                "behavior-option": "Driver behavior",
                "price-option": "Price issue",
                "vehicle-option": "Vehicle condition",
                "route-option": "Inappropriate route",
                "other-option": "Other",
                "complaint-details-label": "Complaint details *",
                "complaint-date-label": "Date and time *",
                "complaint-location-label": "Location (optional)",
                "submit-complaint-button": "Submit complaint",
                "complaint-detail-title": "Complaint detail #",
                "complaint-info-title": "Complaint information",
                "complaint-date-label2": "Date:",
                "complaint-taxi-label": "Taxi:",
                "complaint-type-label2": "Type:",
                "complaint-status-label": "Status:",
                "complaint-details-label2": "Details:",
                "update-status-title": "Update status",
                "status-pending-label": "Pending",
                "status-resolved-label": "Resolved",
                "status-rejected-label": "Rejected",
                "status-danger-label": "Danger",
                "message-driver-label": "Message to driver",
                "update-status-button": "Update status",
                "send-message-button": "Send message",
                "notifications-title": "Notifications",
                "notification-from": "From",
                "mark-read": "Mark as read",
                "mark-unread": "Mark as unread",
                "no-notifications": "No notifications",
                "login-error": "Incorrect email or password",
                "admin-login-error": "Incorrect admin credentials",
                "history-modal-title": "Ride History"
            }
        };

        // Fonctions d'initialisation
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('complaintDate').value = localDateTime;
            initStarRating();
            initLanguageSelector();
            loadRatingsFromLocalStorage();
            loadComplaintsFromLocalStorage();
            displayRecentRatings();
            displayRecentComplaints();
        });

        // Initialisation du sélecteur de langue
        function initLanguageSelector() {
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const lang = button.getAttribute('data-lang');
                    changeLanguage(lang);
                    langButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                });
            });
        }

        // Changer la langue de l'interface
        function changeLanguage(lang) {
            currentLanguage = lang;
            const elements = document.querySelectorAll('[id]');
            elements.forEach(element => {
                const key = element.id;
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            if (lang === 'ar') {
                document.body.setAttribute('dir', 'rtl');
                document.body.style.textAlign = 'right';
            } else {
                document.body.setAttribute('dir', 'ltr');
                document.body.style.textAlign = 'left';
            }
        }

        // Initialisation du système de notation par étoiles
        function initStarRating() {
            const stars = document.querySelectorAll('.star-rating i');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    const rating = parseInt(star.getAttribute('data-rating'));
                    currentRating = rating;
                    stars.forEach(s => {
                        const starRating = parseInt(s.getAttribute('data-rating'));
                        if (starRating <= rating) {
                            s.classList.add('active');
                            s.classList.remove('far');
                            s.classList.add('fas');
                        } else {
                            s.classList.remove('active');
                            s.classList.remove('fas');
                            s.classList.add('far');
                        }
                    });
                });
                star.addEventListener('mouseover', () => {
                    const rating = parseInt(star.getAttribute('data-rating'));
                    stars.forEach(s => {
                        const starRating = parseInt(s.getAttribute('data-rating'));
                        if (starRating <= rating) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
                star.addEventListener('mouseout', () => {
                    stars.forEach(s => {
                        const starRating = parseInt(s.getAttribute('data-rating'));
                        if (starRating > currentRating) {
                            s.classList.remove('active');
                        }
                    });
                });
            });
        }

        // Fonctions de modal
        function openLoginModal() {
            closeAllModals();
            document.getElementById('loginModal').style.display = 'flex';
        }

        function openAdminLoginModal() {
            closeAllModals();
            document.getElementById('adminLoginModal').style.display = 'flex';
        }

        function openRegisterModal() {
            closeAllModals();
            document.getElementById('registerModal').style.display = 'flex';
        }

        function openDriverRegisterModal() {
            if (!currentUser || (currentUser.type !== 'driver' && currentUser.type !== 'admin')) {
                alert(currentLanguage === 'fr' ? 'Veuillez vous connecter en tant que chauffeur ou administrateur' :
                      currentLanguage === 'ar' ? 'يرجى تسجيل الدخول كسائق أو مشرف' :
                      'Please login as a driver or administrator');
                if (!currentUser) openLoginModal();
                return;
            }
            closeAllModals();
            document.getElementById('driverRegisterModal').style.display = 'flex';
        }

        function openRatingModal() {
            if (!currentUser) {
                alert(currentLanguage === 'fr' ? 'Veuillez vous connecter pour noter un chauffeur' :
                      currentLanguage === 'ar' ? 'يرجى تسجيل الدخول لتقييم السائق' :
                      'Please login to rate a driver');
                openLoginModal();
                return;
            }
            if (currentUser.type !== 'client') {
                alert(currentLanguage === 'fr' ? 'Cette fonctionnalité est réservée aux clients' :
                      currentLanguage === 'ar' ? 'هذه الميزة مخصصة للعملاء فقط' :
                      'This feature is for clients only');
                return;
            }
            closeAllModals();
            document.getElementById('ratingModal').style.display = 'flex';
        }

        function openComplaintModal() {
            if (!currentUser) {
                alert(currentLanguage === 'fr' ? 'Veuillez vous connecter pour déposer une plainte' :
                      currentLanguage === 'ar' ? 'يرجى تسجيل الدخول لتقديم شكوى' :
                      'Please login to file a complaint');
                openLoginModal();
                return;
            }
            if (currentUser.type !== 'client') {
                alert(currentLanguage === 'fr' ? 'Cette fonctionnalité est réservée aux clients' :
                      currentLanguage === 'ar' ? 'هذه الميزة مخصصة للعملاء فقط' :
                      'This feature is for clients only');
                return;
            }
            closeAllModals();
            document.getElementById('complaintModal').style.display = 'flex';
        }

        function openHistoryModal() {
            if (!currentUser || currentUser.type !== 'client') {
                alert(currentLanguage === 'fr' ? 'Cette fonctionnalité est réservée aux clients' :
                      currentLanguage === 'ar' ? 'هذه الميزة مخصصة للعملاء فقط' :
                      'This feature is for clients only');
                return;
            }
            closeAllModals();
            document.getElementById('historyModal').style.display = 'flex';
            loadHistory();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeAllModals();
            }
        }

        // Basculer entre les formulaires
        function switchToRegister() {
            closeAllModals();
            openRegisterModal();
        }

        function switchToLogin() {
            closeAllModals();
            openLoginModal();
        }

        function switchToAdminLogin() {
            closeAllModals();
            openAdminLoginModal();
        }

        function switchToUserLogin() {
            closeAllModals();
            openLoginModal();
        }

        // Sélection du type d'utilisateur
        function selectUserType(type) {
            userType = type;
            const clientType = document.getElementById('client-type');
            const driverType = document.getElementById('driver-type');
            const driverFields = document.getElementById('driver-fields');
            if (type === 'client') {
                clientType.classList.add('active');
                driverType.classList.remove('active');
                driverFields.style.display = 'none';
            } else {
                clientType.classList.remove('active');
                driverType.classList.add('active');
                driverFields.style.display = 'block';
            }
        }

        // Fonctions d'authentification
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('login-error');
            if (!email || !password) {
                alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs' :
                      currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول' :
                      'Please fill in all fields');
                return;
            }
            const user = mockUsers.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                errorElement.style.display = 'none';
                alert((currentLanguage === 'fr' ? 'Bienvenue ' :
                       currentLanguage === 'ar' ? 'مرحبًا ' :
                       'Welcome ') + user.name + '!');
                closeAllModals();
                updateUIAfterLogin();
                if (user.type === 'driver') {
                    showDriverNotifications();
                }
            } else {
                errorElement.style.display = 'block';
            }
        }

        function adminLogin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const errorElement = document.getElementById('admin-login-error');
            if (!email || !password) {
                alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs' :
                      currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول' :
                      'Please fill in all fields');
                return;
            }
            const user = mockUsers.find(u => u.email === email && u.password === password && u.type === 'admin');
            if (user) {
                currentUser = user;
                errorElement.style.display = 'none';
                alert(currentLanguage === 'fr' ? 'Connexion administrateur réussie!' :
                      currentLanguage === 'ar' ? 'تم تسجيل دخول المشرف بنجاح!' :
                      'Admin login successful!');
                closeAllModals();
                document.getElementById('main-interface').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                displayRecentComplaints();
                displayRecentReviews();
            } else {
                errorElement.style.display = 'block';
            }
        }

        function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            if (!name || !email || !phone || !password || !confirmPassword) {
                alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs obligatoires' :
                      currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول الإلزامية' :
                      'Please fill in all required fields');
                return;
            }
            if (password !== confirmPassword) {
                alert(currentLanguage === 'fr' ? 'Les mots de passe ne correspondent pas' :
                      currentLanguage === 'ar' ? 'كلمات المرور غير متطابقة' :
                      'Passwords do not match');
                return;
            }
            if (userType === 'driver') {
                const license = document.getElementById('registerLicense').value;
                const taxiNumber = document.getElementById('registerTaxiNumber').value;
                const matricule = document.getElementById('registerMatricule').value;
                if (!license || !taxiNumber || !matricule) {
                    alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs pour les chauffeurs' :
                          currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول للسائقين' :
                          'Please fill in all fields for drivers');
                    return;
                }
            }
            alert((currentLanguage === 'fr' ? 'Inscription réussie! Bienvenue ' :
                   currentLanguage === 'ar' ? 'تم التسجيل بنجاح! مرحبًا ' :
                   'Registration successful! Welcome ') + name);
            closeAllModals();
            currentUser = { name, email, type: userType };
            updateUIAfterLogin();
        }

        function registerDriver() {
            const name = document.getElementById('driverName').value;
            const license = document.getElementById('driverLicense').value;
            const taxiNumber = document.getElementById('driverTaxiNumber').value;
            const matricule = document.getElementById('driverMatricule').value;
            const phone = document.getElementById('driverPhone').value;
            const email = document.getElementById('driverEmail').value;
            if (!name || !license || !taxiNumber || !matricule || !phone || !email) {
                alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs' :
                      currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول' :
                      'Please fill in all fields');
                return;
            }
            alert(currentLanguage === 'fr' ? 'Votre taxi a été enregistré avec succès!' :
                  currentLanguage === 'ar' ? 'تم تسجيل التاكسي بنجاح!' :
                  'Your taxi has been registered successfully!');
            closeAllModals();
        }

        function updateUIAfterLogin() {
            const authButtons = document.querySelector('.auth-buttons');
            authButtons.innerHTML = `
                <button class="auth-btn" onclick="logout()">${currentLanguage === 'fr' ? 'Déconnexion' : currentLanguage === 'ar' ? 'تسجيل الخروج' : 'Logout'}</button>
                <span style="color: white; padding: 8px 15px;">${currentLanguage === 'fr' ? 'Bonjour' : currentLanguage === 'ar' ? 'مرحبًا' : 'Hello'}, ${currentUser.name}</span>
            `;
            if (currentUser.type === 'driver') {
                document.getElementById('rating-card').style.display = 'none';
                document.getElementById('complaint-card').style.display = 'none';
                document.getElementById('notification-container').style.display = 'block';
                document.getElementById('driver-card').style.display = 'block';
            } else if (currentUser.type === 'client') {
                document.getElementById('rating-card').style.display = 'block';
                document.getElementById('complaint-card').style.display = 'block';
                document.getElementById('notification-container').style.display = 'none';
                document.getElementById('driver-card').style.display = 'none';
            } else if (currentUser.type === 'admin') {
                document.getElementById('rating-card').style.display = 'none';
                document.getElementById('complaint-card').style.display = 'none';
                document.getElementById('notification-container').style.display = 'none';
                document.getElementById('driver-card').style.display = 'block';
            }
        }

        function logout() {
            currentUser = null;
            alert(currentLanguage === 'fr' ? 'Vous avez été déconnecté' :
                  currentLanguage === 'ar' ? 'تم تسجيل الخروج' :
                  'You have been logged out');
            document.getElementById('main-interface').style.display = 'block';
            document.getElementById('admin-dashboard').style.display = 'none';
            const authButtons = document.querySelector('.auth-buttons');
            authButtons.innerHTML = `
                <button class="auth-btn" onclick="openLoginModal()" id="login-btn">${currentLanguage === 'fr' ? 'Connexion' : currentLanguage === 'ar' ? 'تسجيل الدخول' : 'Login'}</button>
                <button class="auth-btn" onclick="openRegisterModal()" id="register-btn">${currentLanguage === 'fr' ? 'Inscription' : currentLanguage === 'ar' ? 'تسجيل' : 'Register'}</button>
            `;
            document.getElementById('rating-card').style.display = 'block';
            document.getElementById('complaint-card').style.display = 'block';
            document.getElementById('driver-card').style.display = 'block';
            document.getElementById('notification-container').style.display = 'none';
        }

        // Soumission des notations et plaintes
        function submitRating() {
            if (!currentUser) {
                alert(currentLanguage === 'fr' ? 'Veuillez vous connecter pour noter un chauffeur' :
                      currentLanguage === 'ar' ? 'يرجى تسجيل الدخول لتقييم السائق' :
                      'Please login to rate a driver');
                openLoginModal();
                return;
            }
            const taxiNumber = document.getElementById('taxiNumber').value;
            const comment = document.getElementById('ratingComment').value;
            if (!taxiNumber) {
                alert(currentLanguage === 'fr' ? 'Veuillez entrer le numéro de taxi ou immatriculation' :
                      currentLanguage === 'ar' ? 'يرجى إدخال رقم التاكسي أو رقم التسجيل' :
                      'Please enter the taxi number or registration');
                return;
            }
            if (currentRating === 0) {
                alert(currentLanguage === 'fr' ? 'Veuillez sélectionner une note' :
                      currentLanguage === 'ar' ? 'يرجى اختيار تقييم' :
                      'Please select a rating');
                return;
            }

            const rating = {
                id: Date.now(),
                userId: currentUser.id,
                taxiNumber: taxiNumber,
                rating: currentRating,
                comment: comment,
                date: new Date().toLocaleDateString(),
                location: "Alger"
            };

            saveRatingToLocalStorage(rating);

            const driver = mockUsers.find(u => u.type === 'driver' && (u.taxiNumber === taxiNumber || u.matricule === taxiNumber));
            if (driver) {
                const newNotification = {
                    id: Date.now(),
                    driverId: driver.id,
                    taxiNumber: taxiNumber,
                    type: 'notation',
                    message: currentLanguage === 'fr' ? `Nouvelle notation reçue: ${currentRating} étoiles` :
                             currentLanguage === 'ar' ? `تم استلام تقييم جديد: ${currentRating} نجوم` :
                             `New rating received: ${currentRating} stars`,
                    date: new Date().toLocaleDateString(),
                    read: false
                };
                driverNotifications.push(newNotification);
                if (currentUser && currentUser.id === driver.id) {
                    updateNotificationBadge();
                }
            }

            alert(currentLanguage === 'fr' ? 'Merci pour votre notation !' :
                  currentLanguage === 'ar' ? 'شكرًا لك على التقييم!' :
                  'Thank you for your rating!');
            closeModal('ratingModal');
            document.getElementById('ratingForm').reset();
            const stars = document.querySelectorAll('.star-rating i');
            stars.forEach(s => {
                s.classList.remove('active');
                s.classList.remove('fas');
                s.classList.add('far');
            });
            currentRating = 0;
            displayRecentRatings();
        }

        function submitComplaint() {
            const taxiNumber = document.getElementById('complaintTaxiNumber').value;
            const type = document.getElementById('complaintType').value;
            const details = document.getElementById('complaintDetails').value;
            const date = document.getElementById('complaintDate').value;
            const location = document.getElementById('complaintLocation').value;
            if (!taxiNumber || !type || !details || !date) {
                alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs obligatoires' :
                      currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول الإلزامية' :
                      'Please fill in all required fields');
                return;
            }

            const complaint = {
                id: Date.now(),
                userId: currentUser ? currentUser.id : null,
                taxiNumber: taxiNumber,
                type: type,
                details: details,
                date: date,
                location: location,
                status: 'pending'
            };

            saveComplaintToLocalStorage(complaint);

            const driver = mockUsers.find(u => u.type === 'driver' && (u.taxiNumber === taxiNumber || u.matricule === taxiNumber));
            if (driver) {
                const complaintTypeText = document.getElementById('complaintType').options[document.getElementById('complaintType').selectedIndex].text;
                const newNotification = {
                    id: Date.now(),
                    driverId: driver.id,
                    taxiNumber: taxiNumber,
                    type: 'plainte',
                    message: currentLanguage === 'fr' ? `Nouvelle plainte de type: ${complaintTypeText}` :
                             currentLanguage === 'ar' ? `شكوى جديدة من نوع: ${complaintTypeText}` :
                             `New complaint of type: ${complaintTypeText}`,
                    date: new Date().toLocaleDateString(),
                    read: false
                };
                driverNotifications.push(newNotification);
                if (currentUser && currentUser.id === driver.id) {
                    updateNotificationBadge();
                }
            }

            alert(currentLanguage === 'fr' ? 'Votre plainte a été enregistrée. Nous la traiterons dans les plus brefs délais.' :
                  currentLanguage === 'ar' ? 'تم تسجيل شكواك. سنقوم بمعالجتها في أقرب وقت ممكن.' :
                  'Your complaint has been recorded. We will process it as soon as possible.');
            closeModal('complaintModal');
            document.getElementById('complaintForm').reset();
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('complaintDate').value = localDateTime;
            displayRecentComplaints();
        }

        // Gestion des notifications pour les chauffeurs
        function showDriverNotifications() {
            const notificationContainer = document.getElementById('notification-container');
            notificationContainer.style.display = 'block';
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            if (!currentUser || currentUser.type !== 'driver') return;
            const unreadCount = driverNotifications.filter(n => n.driverId === currentUser.id && !n.read).length;
            const badge = document.getElementById('notification-badge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function toggleNotifications() {
            if (!currentUser || currentUser.type !== 'driver') return;
            const notificationsPanel = document.getElementById('driver-notifications');
            notificationsVisible = !notificationsVisible;
            if (notificationsVisible) {
                displayNotifications();
                notificationsPanel.style.display = 'block';
            } else {
                notificationsPanel.style.display = 'none';
            }
        }

        function displayNotifications() {
            if (!currentUser || currentUser.type !== 'driver') return;
            const notificationsList = document.getElementById('notifications-list');
            const driverNotes = driverNotifications.filter(n => n.driverId === currentUser.id);
            if (driverNotes.length === 0) {
                notificationsList.innerHTML = `<p>${translations[currentLanguage]['no-notifications']}</p>`;
                return;
            }
            notificationsList.innerHTML = '';
            driverNotes.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item ${notification.read ? '' : 'unread'}`;
                notificationItem.innerHTML = `
                    <p><strong>${notification.message}</strong></p>
                    <p>${translations[currentLanguage]['notification-from']}: ${notification.taxiNumber} - ${notification.date}</p>
                    <button onclick="markNotificationAs(${notification.id}, ${!notification.read})">
                        ${notification.read ? translations[currentLanguage]['mark-unread'] : translations[currentLanguage]['mark-read']}
                    </button>
                `;
                notificationsList.appendChild(notificationItem);
            });
        }

        function markNotificationAs(id, read) {
            const notification = driverNotifications.find(n => n.id === id);
            if (notification) {
                notification.read = read;
                updateNotificationBadge();
                displayNotifications();
            }
        }

        // Fonctions pour l'administration des plaintes
        function viewComplaint(id) {
            currentComplaintId = id;
            const complaints = loadComplaintsFromLocalStorage();
            const complaint = complaints.find(c => c.id == id);
            if (complaint) {
                document.getElementById('complaint-id').textContent = id;
                document.getElementById('complaint-date-value').textContent = complaint.date;
                document.getElementById('complaint-taxi-value').textContent = complaint.taxiNumber;
                document.getElementById('complaint-type-value').textContent = complaint.type;
                let statusText = '';
                if (complaint.status === 'pending') statusText = translations[currentLanguage]['pending-text'];
                else if (complaint.status === 'resolved') statusText = translations[currentLanguage]['resolved-text'];
                else if (complaint.status === 'rejected') statusText = translations[currentLanguage]['rejected-text'];
                else if (complaint.status === 'danger') statusText = translations[currentLanguage]['danger-text'];
                document.getElementById('complaint-status-value').textContent = statusText;
                document.getElementById('complaint-details-value').textContent = complaint.details;
                document.querySelectorAll('input[name="complaintStatus"]').forEach(radio => {
                    radio.checked = false;
                });
                if (complaint.status === 'resolved') document.getElementById('status-resolved').checked = true;
                else if (complaint.status === 'rejected') document.getElementById('status-rejected').checked = true;
                else if (complaint.status === 'danger') document.getElementById('status-danger').checked = true;
                else document.getElementById('status-pending').checked = true;
                closeAllModals();
                document.getElementById('complaintDetailModal').style.display = 'flex';
            }
        }

        function resolveComplaint(id) {
            const complaints = loadComplaintsFromLocalStorage();
            const complaintIndex = complaints.findIndex(c => c.id == id);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = 'resolved';
                localStorage.setItem('complaints', JSON.stringify(complaints));
                alert(currentLanguage === 'fr' ? 'Plainte marquée comme résolue' :
                      currentLanguage === 'ar' ? 'تم وضع علامة على الشكوى كمحلولة' :
                      'Complaint marked as resolved');
                displayRecentComplaints();
            }
        }

        function rejectComplaint(id) {
            const complaints = loadComplaintsFromLocalStorage();
            const complaintIndex = complaints.findIndex(c => c.id == id);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = 'rejected';
                localStorage.setItem('complaints', JSON.stringify(complaints));
                alert(currentLanguage === 'fr' ? 'Plainte marquée comme rejetée' :
                      currentLanguage === 'ar' ? 'تم وضع علامة على الشكوى كمرفوضة' :
                      'Complaint marked as rejected');
                displayRecentComplaints();
            }
        }

        function markComplaintDanger(id) {
            const complaints = loadComplaintsFromLocalStorage();
            const complaintIndex = complaints.findIndex(c => c.id == id);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = 'danger';
                localStorage.setItem('complaints', JSON.stringify(complaints));
                alert(currentLanguage === 'fr' ? 'Plainte marquée comme danger' :
                      currentLanguage === 'ar' ? 'تم وضع علامة على الشكوى كخطر' :
                      'Complaint marked as danger');
                displayRecentComplaints();
            }
        }

        function updateComplaintStatus() {
            if (!currentComplaintId) return;
            const status = document.querySelector('input[name="complaintStatus"]:checked');
            if (!status) {
                alert(currentLanguage === 'fr' ? 'Veuillez sélectionner un statut' :
                      currentLanguage === 'ar' ? 'يرجى اختيار حالة' :
                      'Please select a status');
                return;
            }
            const complaints = loadComplaintsFromLocalStorage();
            const complaintIndex = complaints.findIndex(c => c.id == currentComplaintId);
            if (complaintIndex !== -1) {
                complaints[complaintIndex].status = status.value;
                localStorage.setItem('complaints', JSON.stringify(complaints));
                alert(currentLanguage === 'fr' ? 'Statut de la plainte mis à jour' :
                      currentLanguage === 'ar' ? 'تم تحديث حالة الشكوى' :
                      'Complaint status updated');
                closeModal('complaintDetailModal');
                displayRecentComplaints();
            }
        }

        function sendMessageToDriver() {
            const message = document.getElementById('driverMessage').value;
            if (!message) {
                alert(currentLanguage === 'fr' ? 'Veuillez saisir un message' :
                      currentLanguage === 'ar' ? 'يرجى إدخال رسالة' :
                      'Please enter a message');
                return;
            }
            const complaints = loadComplaintsFromLocalStorage();
            const complaint = complaints.find(c => c.id == currentComplaintId);
            if (complaint) {
                const driver = mockUsers.find(u => u.type === 'driver' && (u.taxiNumber === complaint.taxiNumber || u.matricule === complaint.taxiNumber));
                if (driver) {
                    alert(currentLanguage === 'fr' ? `Message envoyé au chauffeur (${driver.phone}): ${message}` :
                          currentLanguage === 'ar' ? `تم إرسال الرسالة إلى السائق (${driver.phone}): ${message}` :
                          `Message sent to driver (${driver.phone}): ${message}`);
                    closeModal('complaintDetailModal');
                } else {
                    alert(currentLanguage === 'fr' ? 'Chauffeur non trouvé' :
                          currentLanguage === 'ar' ? 'لم يتم العثور على السائق' :
                          'Driver not found');
                }
            }
        }

        function notifyDriver(id) {
            const complaints = loadComplaintsFromLocalStorage();
            const complaint = complaints.find(c => c.id == id);
            if (complaint) {
                const driver = mockUsers.find(u => u.type === 'driver' && (u.taxiNumber === complaint.taxiNumber || u.matricule === complaint.taxiNumber));
                if (driver) {
                    const message = currentLanguage === 'fr' ?
                        `Vous êtes convoqué pour une plainte concernant votre taxi. Veuillez contacter l'administration.` :
                        currentLanguage === 'ar' ?
                        'تم استدعاؤك بشكوى متعلقة بتاكسيك. يرجى الاتصال بالإدارة.' :
                        'You are summoned for a complaint regarding your taxi. Please contact the administration.';
                    alert(currentLanguage === 'fr' ? `Message de convocation envoyé au chauffeur: ${driver.phone}` :
                          currentLanguage === 'ar' ? `تم إرسال رسالة الاستدعاء إلى السائق: ${driver.phone}` :
                          `Summons message sent to driver: ${driver.phone}`);
                }
            }
        }

        function viewRating(id) {
            const ratings = loadRatingsFromLocalStorage();
            const rating = ratings.find(r => r.id == id);
            if (rating) {
                alert(currentLanguage === 'fr' ? `Avis #${id}: ${rating.taxiNumber} - ${rating.rating} étoiles - ${rating.comment}` :
                      currentLanguage === 'ar' ? `التقييم #${id}: ${rating.taxiNumber} - ${rating.rating} نجوم - ${rating.comment}` :
                      `Rating #${id}: ${rating.taxiNumber} - ${rating.rating} stars - ${rating.comment}`);
            }
        }

        // Charger l'historique des courses
        function loadHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            const ratings = loadRatingsFromLocalStorage();
            const userRatings = ratings.filter(rating => rating.userId == currentUser.id);
            if (userRatings.length === 0) {
                historyList.innerHTML = '<tr><td colspan="4">Aucune course enregistrée</td></tr>';
                return;
            }
            userRatings.forEach(rating => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rating.date}</td>
                    <td>${rating.taxiNumber}</td>
                    <td>${rating.rating}/5</td>
                    <td>${rating.comment || 'Aucun commentaire'}</td>
                `;
                historyList.appendChild(row);
            });
        }

        // Fonctions supplémentaires pour l'interface
        function showNotifications() {
            alert(currentLanguage === 'fr' ? 'Fonctionnalité de notifications à implémenter' :
                  currentLanguage === 'ar' ? 'ميزة الإشعارات قيد التطوير' :
                  'Notification feature to be implemented');
        }

        function toggleUserMenu() {
            alert(currentLanguage === 'fr' ? 'Menu utilisateur à implémenter' :
                  currentLanguage === 'ar' ? 'قائمة المستخدم قيد التطوير' :
                  'User menu to be implemented');
        }

        function showSettings() {
            alert(currentLanguage === 'fr' ? 'Paramètres à implémenter' :
                  currentLanguage === 'ar' ? 'الإعدادات قيد التطوير' :
                  'Settings to be implemented');
        }

        // Gestion du localStorage pour les notes
        function saveRatingToLocalStorage(rating) {
            let ratings = JSON.parse(localStorage.getItem('ratings')) || [];
            ratings.push(rating);
            localStorage.setItem('ratings', JSON.stringify(ratings));
        }

        function loadRatingsFromLocalStorage() {
            return JSON.parse(localStorage.getItem('ratings')) || [];
        }

        // Gestion du localStorage pour les plaintes
        function saveComplaintToLocalStorage(complaint) {
            let complaints = JSON.parse(localStorage.getItem('complaints')) || [];
            complaints.push(complaint);
            localStorage.setItem('complaints', JSON.stringify(complaints));
        }

        function loadComplaintsFromLocalStorage() {
            return JSON.parse(localStorage.getItem('complaints')) || [];
        }

        // Afficher les notes récentes
        function displayRecentRatings() {
            const recentRatingsContainer = document.getElementById('recent-ratings-container');
            recentRatingsContainer.innerHTML = '';
            const ratings = loadRatingsFromLocalStorage();
            const recentRatings = ratings.slice(-3).reverse();
            if (recentRatings.length === 0) {
                recentRatingsContainer.innerHTML = '<p>Aucune notation récente.</p>';
                return;
            }
            recentRatings.forEach(rating => {
                const ratingItem = document.createElement('div');
                ratingItem.className = 'rating-item';
                ratingItem.innerHTML = `
                    <div class="rating-info">
                        <div class="rating-avatar">${rating.taxiNumber.slice(0, 2)}</div>
                        <div class="rating-details">
                            <h4>${rating.taxiNumber}</h4>
                            <p>${rating.date} - ${rating.location || 'Alger'}</p>
                        </div>
                    </div>
                    <div class="rating-stars">
                        ${generateStarHTML(rating.rating)}
                    </div>
                `;
                recentRatingsContainer.appendChild(ratingItem);
            });
            // Mettre à jour les statistiques
            updateStats();
        }

        // Afficher les plaintes récentes (admin)
        function displayRecentComplaints() {
            const complaintsTableBody = document.getElementById('recent-complaints-list');
            complaintsTableBody.innerHTML = '';
            const complaints = loadComplaintsFromLocalStorage();
            const recentComplaints = complaints.slice(-3).reverse();
            if (recentComplaints.length === 0) {
                complaintsTableBody.innerHTML = '<tr><td colspan="6">Aucune plainte récente.</td></tr>';
                return;
            }
            recentComplaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${complaint.id}</td>
                    <td>${complaint.date}</td>
                    <td>${complaint.taxiNumber}</td>
                    <td>${complaint.type}</td>
                    <td><span class="status-badge status-${complaint.status}">${complaint.status === 'pending' ? 'En attente' : complaint.status === 'resolved' ? 'Résolu' : complaint.status === 'rejected' ? 'Rejeté' : 'Danger'}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view" onclick="viewComplaint(${complaint.id})">Voir</button>
                        ${complaint.status === 'pending' ? `
                            <button class="action-btn resolve" onclick="resolveComplaint(${complaint.id})">Résoudre</button>
                            <button class="action-btn reject" onclick="rejectComplaint(${complaint.id})">Rejeter</button>
                            <button class="action-btn danger" onclick="markComplaintDanger(${complaint.id})">Danger</button>
                        ` : ''}
                    </td>
                `;
                complaintsTableBody.appendChild(row);
            });
            // Mettre à jour les statistiques admin
            updateAdminStats();
        }

        // Afficher les avis récents (admin)
        function displayRecentReviews() {
            const reviewsTableBody = document.getElementById('recent-reviews-list');
            reviewsTableBody.innerHTML = '';
            const ratings = loadRatingsFromLocalStorage();
            const recentRatings = ratings.slice(-3).reverse();
            if (recentRatings.length === 0) {
                reviewsTableBody.innerHTML = '<tr><td colspan="5">Aucun avis récent.</td></tr>';
                return;
            }
            recentRatings.forEach(rating => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>#${rating.id}</td>
                    <td>${rating.date}</td>
                    <td>${rating.taxiNumber}</td>
                    <td>
                        <div class="rating-stars">
                            ${generateStarHTML(rating.rating)}
                        </div>
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn view" onclick="viewRating(${rating.id})">Voir</button>
                    </td>
                `;
                reviewsTableBody.appendChild(row);
            });
        }

        // Générer les étoiles en HTML
        function generateStarHTML(rating) {
            let starsHTML = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    starsHTML += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    starsHTML += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    starsHTML += '<i class="far fa-star"></i>';
                }
            }
            return starsHTML;
        }

        // Mettre à jour les statistiques utilisateur
        function updateStats() {
            const ratings = loadRatingsFromLocalStorage();
            const complaints = loadComplaintsFromLocalStorage();
            const userRatings = ratings.filter(r => r.userId == (currentUser ? currentUser.id : null));
            const userComplaints = complaints.filter(c => c.userId == (currentUser ? currentUser.id : null));

            const avgRating = userRatings.length > 0 ?
                (userRatings.reduce((sum, r) => sum + r.rating, 0) / userRatings.length).toFixed(1) : 0;
            const satisfaction = userRatings.length > 0 ?
                Math.round((userRatings.filter(r => r.rating >= 4).length / userRatings.length) * 100) : 0;

            document.getElementById('average-rating-value').textContent = avgRating;
            document.getElementById('rated-rides-value').textContent = userRatings.length;
            document.getElementById('satisfaction-value').textContent = satisfaction + '%';
            document.getElementById('complaints-filed-value').textContent = userComplaints.length;
        }

        // Mettre à jour les statistiques admin
        function updateAdminStats() {
            const ratings = loadRatingsFromLocalStorage();
            const complaints = loadComplaintsFromLocalStorage();
            const pendingComplaints = complaints.filter(c => c.status === 'pending').length;
            const thisMonthRatings = ratings.filter(r => {
                const ratingDate = new Date(r.date);
                const now = new Date();
                return ratingDate.getMonth() === now.getMonth() && ratingDate.getFullYear() === now.getFullYear();
            }).length;

            document.getElementById('pending-complaints-value').textContent = pendingComplaints;
            document.getElementById('reviews-this-month-value').textContent = thisMonthRatings;
            // Les autres valeurs sont statiques dans cet exemple
        }
    </script>
</body>
</html>
